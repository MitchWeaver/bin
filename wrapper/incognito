#!/bin/sh
#
# http://github.com/mitchweaver
#
# chrome incognito on temp user
#
# shellcheck disable=SC2046
#

rgen() {
    LC_ALL=C \
    tr -dc -- A-Z-a-z-0-9 < /dev/urandom 2>/dev/null | \
    dd ibs=1 obs=1 count="${1:-16}" 2>/dev/null | \
    sed 's/\-//g'
}

name=$(rgen 6 | sed 's/\-//g')
echo "Creating a new user account: $name"
sudo useradd -d "/tmp/$name" -m -G video,audio,pulse,pulse-access "$name"
sudo chmod -R 777 "/tmp/$name"

for i in google-chrome google-chrome-stable \
    chromium chromium-browser ; do
    if command -v $i >/dev/null ; then
        chrome=$i
        break
    fi
done

sudo -u "$name" \
    $(command -v $chrome --incognito) \
    "${1:-https://start.duckduckgo.com}"

echo "Deleting temp user account: $name"
sudo pkill -9 -u "$name" ; sudo pkill -9 -u "$name"
sudo userdel -r "$name"
