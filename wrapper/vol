#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# simple OpenBSD volume wrapper
#

usage() {
    >&2 echo 'usage: vol [-i] [-d] [-s] [-m]'
    exit 1
}

inc()    { mixerctl -q outputs.master=+"$1"    ; }
dec()    { mixerctl -q outputs.master=-"$1"    ; }
mute()   { mixerctl -q outputs.master.mute=on  ; }
unmute() { mixerctl -q outputs.master.mute=off ; }

get_vol() {
    vol=$(mixerctl -n outputs.master)
    vol=$(echo "scale=2;${vol%,*} / 255" | bc)
    vol=${vol#.}
    vol=${vol#0}
    case $vol in
        1.00) echo 100 ;;
         .00) echo 0 ;;
           *) echo $vol
    esac
}

set_vol() {
    if [ "$1" -gt 100 ] ; then
        set 100
    elif [ "$1" -lt 0 ] ; then
        set 0
    fi
    set -- $(echo "$1 * 2.55" | bc)
    [ "${1%%.*}" -gt 255 ] && set 255
    mixerctl outputs.master=${1%%.*} >/dev/null
}

case "$1" in
    -i|*inc)    inc "$2"     ;;
    -d|*dec)    dec "$2"     ;;
    -s|*set)    set_vol "$2" ;;
    -m|*mute)   mute         ;;
    -u|*unmute) unmute       ;;
    -h|*help)   usage        ;;
    *) get_vol
esac
