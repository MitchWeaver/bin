#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# simple volume wrapper
#

usage() {
    >&2 printf '%s\n' "Usage: ${0##*/} [i] [d] [s]"
    exit
}

case ${1#-} in
    h)
        usage
        ;;
    *)
        case $(uname) in
            OpenBSD)
                case ${1#-} in
                    i) mixerctl -q outputs.master=+"${2:-5}" ;;
                    d) mixerctl -q outputs.master=-"${2:-5}" ;;
                    s) mixerctl -q outputs.master="$2" ;;
                    *)
                        vol=$(mixerctl -n outputs.master)
                        # use only one of the left/right balance
                        # trim comma
                        vol=${vol%,*}
                        # openbsd scales volume 0 to 255, convert to decimal
                        vol=$(printf 'scale=2;%s / 255\n' "$vol" | bc)
                        vol=${vol#.}
                        # catch edge cases, prettify
                        case $vol in
                            1.00)
                                vol=100
                                ;;
                            (0.00)
                                vol=0
                                ;;
                            [0]?)
                                vol=${vol#0}
                        esac
                        printf '%s\n' "$vol"
                esac
                ;;
            Linux)
                case ${1#-} in
                    i) exec sh -c "pactl set-sink-mute 0 false ; pactl set-sink-volume @DEFAULT_SINK@ +5%" ;;
                    d) exec sh -c "pactl set-sink-mute 0 false ; pactl set-sink-volume @DEFAULT_SINK@ -5%" ;;
                    *) pactl list sinks | grep -i volume | head -n 1 | awk '{ print $5 }'
                esac
        esac
esac
