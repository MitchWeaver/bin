#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# autorice using pywal and other tools
#

usage() {
    printf "%s\n%s\n%s\n\n%s\n%s\n%s\n%s\n" \
        "Usage: " \
        "------------------------------------" \
        "$ rice \"\$wallpaper_path\"" \
        "Options:" \
        "------------------------------------" \
        "--no-kill    -    do not kill progs" \
        "--light      -    make a light theme"
    exit 0
}
[ $# -eq 0 ] && usage

while [ $# -gt 0 ] ; do
    case "$1" in
        --light|-l)   LIGHT=true ;;
        --no-kill|-n) nokill=true ;;
        --help|-h)    usage ;;
        *) path="$1"
    esac
    shift
done

[ -f "$path" ] || usage

wall_path="${HOME}/.wall"
cp -f "$path" "$wall_path" >/dev/null || \
    { >&2 echo "Unable to copy to $wall_path" ; exit 1 ; }

pkill xwinwrap 2>/dev/null 

background "$wall_path" &

if [ "$LIGHT" ] ; then
    wal -qnli "$path"
else
    wal -qni "$path"
fi >/dev/null 2>&1

cat ${HOME}/.cache/wal/sequences

# generate web browser startpage css
if type sassc > /dev/null 2>&1 ; then
    spage=${HOME}/src/startpage
    sassc $spage/scss/style.scss $spage/style.css
fi >/dev/null 2>&1 &

# recomp suckless tools
recomp st tabbed dwm
wait

# restart bar
pkill bar
bar >/dev/null 2>&1 &
