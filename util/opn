#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# yet another plumber script
#

[ "$1" ] || set -- "$(xsel -op)"

case $1 in --)     shift  ;; esac
case $1 in ''|' ') exit 1 ;; esac

edit() {
    if [ t -eq 1 ] ; then
        st -e $EDITOR "$@"
    else
        $EDITOR "$@"
    fi
}

if [ -f "$1" ] ; then
    case ${1##*.} in
        mp4|webm|gif|mkv) pkill -x skroll ; exec mpv $MPV_OPTS -- "$1" ;;
        jpg|png|jpeg|JPG|JPEG) exec img "$1" ;;
        mp3|flac|ogg|opus|wav) exec play "$1" ;;
        pdf|epub)              exec pdf "$1" ;;
        gz|bz2|xz|zip)         exec unpack "$1" ;;
        docx|xlsx|rtf)         exec libreoffice "$1" ;;
        sh|c|h|py|php|js|html) exec edit "$1" ;;
    esac
    # if not caught above, it most likely has no extension
    case $(file "$1") in
        *ASCII*|*'shell script'*|*akefile*|*' make '*)
            exec edit "$1"
            ;;
    esac
else
    case $1 in
        http*)
            case ${1##*.} in
                jpg|png|jpeg|JPG|JPEG)
                    exec img "$1" ;;
                mp3|flac|wav|ogg|opus)
                    exec play "$1" ;;
                zip|gz|bz2|xz|tgz|tar|rar|7z|pdf|epub)
                    exec dl "$1" ;;
                mp4|webm|gif|mkv)
                    pkill -x skroll ; exec mpv $MPV_OPTS -- "$1"
            esac
            case $1 in
                *bandcamp*|*soundcloud*)
                    pkill -x skroll
                    exec play "$1"
                    ;;
                *tube*|*tu.be*|*invidio*|*vimeo*)
                    pkill -x skroll
                    exec mpv $MPV_OPTS "$(printf '%s\n' "$1" | cleanse)"
                    ;;
                *)
                    exec brws "$1"
            esac
            ;;
        ftp*)
            exec dl "$1"
            ;;
        *)
            # exec notify-send -u low "Unable to plumb $1"
            exit 1
    esac
fi
