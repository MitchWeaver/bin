#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# a tiny xsel/dmenu based clipboard manager
#

log=${XDG_CACHE_HOME:-~/.cache}/clip.log

usage() {
    >&2 echo 'Usage: clip [no args] [-i] [-o] [-d]'
    exit 1
}

setclip() {
    printf '%s\n' "$*" >>"$log"
    content="$*"
    for c in p s b ; do
        printf '%s\n' "$*" | xsel -i$c
    done
}

case $1 in
    -h)
        usage
        ;;
    -i)
        shift
        [ "$1" ] || read inp && set -- "$inp"
        setclip "$*"
        ;;
    -o)
        printf '%s\n' "$content"
        exit
        ;;
    -d)
        :>"$log"
        trap 'rm "$log"' EXIT INT TERM KILL
        while new=$(xsel -op) ; do
            [ "$new" = "$content" ] || setclip "$new"
            sleep 1
        done
        ;;
    *)
        setclip "$(sort -ur "$log" | menu -p 'Clip:')"
esac
