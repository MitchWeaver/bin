#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# a tiny xsel/dmenu based clipboard manager
#

log=${XDG_CACHE_HOME:-~/.cache}/clip.log

usage() { >&2 echo 'Usage: [no args] [-i] [-d]' ; exit 1 ; }

setclip() {
    for c in p s b ; do
        printf '%s\n' "$*" | xsel -i$c
    done
}

case $1 in
    -h)
        usage
        ;;
    -i)
        shift
        [ "$1" ] || read inp && set -- "$inp"
        setclip "$*"
        ;;
    -d)
        :>"$log"
        while sleep 1 ; do
            new=$(xsel -op)
            [ "$new" = "$old" ] && continue
            printf '%s\n' "$new" >>"$log"
            old=$new
        done
        ;;
    *)
        sel=$(sort -ur "$log" | menu -p 'Clip:')
        [ "$sel" ] && setclip "$sel"
esac
