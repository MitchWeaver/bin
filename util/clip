#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# a tiny xsel/dmenu based clipboard manager
#

usage() { >&2 echo "Use -d to start the daemon" ; exit ; }

log=/tmp/clip-$USER.log
menu='menu -p Clipboard:'

if [ $# -eq 0 ] ; then
    [ -f "$log" ] || usage

    # note: the sed is to emulate 'tac' from gnu core utils
    sel="$(cat $log | awk '!seen[$0]++' | sed '1!G;h;$!d' | $menu)"

    [ "$sel" ] || exit 1

    echo -n "$sel" | xsel -ib
    echo -n "$sel" | xsel -is
else
    case $1 in
        --daemon|-d)
            :> "$log"
            while sleep 0.25 ; do
                new="$(xsel -op)"
                [ "$new" = "$old" ] && continue 
                echo "$new" >> "$log"
                old="$new"
            done
            ;;
        *) usage
    esac
fi
