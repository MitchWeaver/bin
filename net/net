#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# ifconfig / wpa_supplicant wrapper (openbsd)
#

[ "$1" ] || set -- $(interface)

>&2 echo "Using interface: $1"

doas ifconfig $1 down
doas sh /etc/netstart $1

case $1 in
    iwn0|urtwn0) dri=openbsd ;;
            em0) dri=wired
esac

doas pkill -9 wpa_supplicant
doas pkill -9 dhclient

doas wpa_supplicant -c /etc/wpa_supplicant.conf -i $1 -D $dri -B
doas dhclient $1
doas rcctl restart slaacd

# doas sed -i -E 's|name.*.[0-9]+.[0-9]+.[0-9]+.[0-9]+||g' /etc/resolv.conf
# doas sed -i '$ a\
# nameserver 84.200.70.80\
# nameserver 84.200.70.40\
# lookup file bind\
# ' /etc/resolv.conf
