#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# ifconfig / wpa_supplicant wrapper
#

# if not running as root, restart script
if [ $(id -u) -ne 0 ] ; then
    sudo -E $0 "$@"
    exit $?
fi

scripts=/home/mitch/bin/net

while true ; do
    int=$($scripts/interface)

    for i in wpa_supplicant sdhcp ; do
        pgrep -f $i && pkill -9 -f $i
    done >/dev/null 2>&1

    ifconfig $int down >/dev/null
    ifconfig $int up >/dev/null

    wpa_supplicant -c /etc/wpa_supplicant.conf \
        -i $int >/var/log/wpa_supplicant.log 2>&1 &

    sleep 1

    sdhcp -d $int 2>/dev/null

    while $scripts/online ; do
        sleep 3
    done
done &
