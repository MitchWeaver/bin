#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# routine backups to my vps with git
#

# if pgrep -x openvpn >/dev/null ; then
#     >&2 echo "Hey, turn off your vpn first!"
#     exit 1
# fi

vps=mitch

bk() {
    name="$1"
    cd "$name"
    git add -A >/dev/null
    git commit -q -m "Automated Commit - \[$(date)\]" >/dev/null
    echo "$(basename "$name") - $(git push -q -u origin master)" 
}

rsync -rtvuh4c --progress --delete \
    --exclude '*.iso' \
    --exclude '*kernel.gz' \
    --exclude '*rootfs.gz' \
    ${HOME}/src/ $vps:src-backup &

for dir in backup bin fonts ; do
    bk ~/usr/$dir &
done

for dir in files images music ; do
    bk ~/var/$dir &
done

for dir in startpage kernels ; do
    bk ~/src/$dir &
done

wait

printf '\n%s\n' 'all backed up!'
