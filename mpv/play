#!/bin/sh
#
# http://github.com/mitchweaver/bin
#
# play a given directory with mpv and display album art.
#

usage() { >&2 echo "./play [-r] [-l] <path>" ; exit 1 ; }

while [ "$1" ] ; do
    case $1 in
        -h) usage ;;
        -r) MPV_OPTS="$MPV_OPTS --shuffle" ; shift ;;
        -l) MPV_OPTS="$MPV_OPTS --loop"    ; shift ;;
         *) path=$* ; break
    esac
done

if [ ! -e "$path" ] ; then
    case $path in
        http|*.*) ;;
               *) exit 1
    esac
fi

pkill -x mpv

nohup mpv $MPV_OPTS --no-video "$path" >/dev/null &

if [ -e "$path" ] ; then
    set -- $(dimensions)
    w=$(( $1 / 4 ))

    nohup feh -Z -q \
        --stretch \
        --ignore-aspect \
        --auto-rotate \
        --scale-down \
        -g ${w}x${w} \
        "$path"/ >/dev/null &
fi
